# Subpath configuration for a YunoHost app
location __PATH__/ {

  # Path to source
  alias __INSTALL_DIR__/;

    # Make sure PHP sessions, etc., work
    include conf.d/yunohost_panel.conf.inc;

    # Serve static files directly (assets and media folders)
    location ~ ^/myapp/(assets|media)/ {
        try_files $uri $uri/ =404;
        access_log off;
        expires 30d;
    }

    # If it's not a file or directory, route to index.php
    try_files $uri $uri/ /myapp/index.php;

    # Protect sensitive files
    location ~ \.(log|htaccess|git|env) {
        deny all;
    }
}

# PHP handler (adjust PHP version as needed)
location ~ ^/myapp/.*\.php$ {
    include snippets/fastcgi-php.conf;
    fastcgi_pass unix:/run/php/php8.2-fpm.sock;  # Replace with your version
    fastcgi_param SCRIPT_FILENAME /var/www/myapp$fastcgi_script_name;
}
